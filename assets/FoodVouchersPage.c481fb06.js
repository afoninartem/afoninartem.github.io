import{h as P,j as c,t as C,Q as z,v as x,z as K,A as G,r as V,C as J,ao as B,B as Y,F as Z,H as f,M as L,G as m,I as R,J as y,aK as ee,O as j,K as _,ad as $,q as te,T as q,R as O,N as X,L as oe,P as ae}from"./index.e029a779.js";import{Q as ne,a as se,C as re}from"./ClosePopup.f7a2bb20.js";import{Q as le}from"./QInput.3a6fe896.js";import{u as ce,a as ue,b as ie,Q as de}from"./QTable.01c17687.js";import{Q as ve}from"./QSpinnerCube.da8b109e.js";import"./use-dark.47dccd53.js";import"./use-form.fabb1506.js";import"./format.3e32b8d9.js";import"./QDialog.1d5c9349.js";import"./selection.dda85523.js";import"./scroll.3eaf60c6.js";import"./use-file-dom-props.f1f4081b.js";import"./use-key-composition.b7bf7482.js";import"./QList.bf999ea6.js";import"./QChip.b1948b17.js";var me=P({name:"QToggle",props:{...ce,icon:String,iconColor:String},emits:ue,setup(e){function u(r,i){const d=c(()=>(r.value===!0?e.checkedIcon:i.value===!0?e.indeterminateIcon:e.uncheckedIcon)||e.icon),a=c(()=>r.value===!0?e.iconColor:null);return()=>[C("div",{class:"q-toggle__track"}),C("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},d.value!==void 0?[C(z,{name:d.value,color:a.value})]:void 0)]}return ie("toggle",u)}}),pe=P({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:u}){const r=K(),i=c(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return C("td",{class:i.value},x(u.default));const d=r.vnode.key,a=(e.props.colsMap!==void 0?e.props.colsMap[d]:null)||e.props.col;if(a===void 0)return;const{row:D}=e.props;return C("td",{class:i.value+a.__tdClass(D),style:a.__tdStyle(D)},x(u.default))}}}),he=P({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:u}){const r=c(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>C("tr",{class:r.value},x(u.default))}});const U=G("vouchers",()=>{const e=V(null),u=V(null),r=V(null),{user:i}=J(),d=async()=>{await B.get("/get-vouchers-valid-range",{headers:{Authorization:`Bearer ${i.token}`}}).then(n=>e.value=n.data.data).catch(n=>console.log(n))},a=async n=>{const v=new Date(n.from).toLocaleDateString().split(".").reverse().join("/"),k=new Date(n.to).toLocaleDateString().split(".").reverse().join("/");await B.get("/get-vouchers-sheet-data",{headers:{Authorization:`Bearer ${i.token}`,"Date-from":v,"Date-to":k}}).then(t=>{u.value=t.data.data}).catch(t=>console.log(t)),await B.get("/get-vouchers-price",{headers:{Authorization:`Bearer ${i.token}`}}).then(t=>r.value=t.data.data).catch(t=>console.log(t))},D=c(()=>{var n;return(n=e.value)==null?void 0:n.map(v=>v.split("T")[0].split("-").join("/"))}),S=c(()=>u.value),Q=c(()=>r.value);return{getValidRange:d,getVoucherData:a,saveXLSX:async n=>{await B.get("/download/vouchers-report",{headers:{Authorization:`Bearer ${i.token}`,"Empty-hide":`${n}`},responseType:"blob"}).then(v=>{const t=`\u041E\u0442\u0447\u0435\u0442 \u043F\u043E \u0442\u0430\u043B\u043E\u043D\u0430\u043C ${v.headers.get("Content-Type").split("; ")[1]}.xlsx`;console.log(t);const w=URL.createObjectURL(v.data),p=document.createElement("a");p.href=w,p.download=t,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(w)}).catch(v=>console.log(v))},validRange:D,vouchersData:S,voucherPrice:Q}});const ge={class:"food-vouchers"},fe=$("h4",null,"\u0422\u0430\u043B\u043E\u043D\u044B",-1),ye={class:"row items-center justify-end"},_e=$("br",null,null,-1),ke={key:2,class:"loader"},$e={__name:"FoodVouchersPage",setup(e){const{getValidRange:u,getVoucherData:r,saveXLSX:i}=U(),{validRange:d,vouchersData:a,voucherPrice:D}=Y(U()),S=new Date,Q=S.getDate()-S.getDay()-6,E=Q+6;let n=new Date(new Date().setDate(Q)),v=new Date(new Date().setDate(E));const k=V(!1),t=V({from:n,to:v}),w=c(()=>typeof t.value=="string"?{from:t.value,to:t.value}:t.value),p=c(()=>`\u041E\u0442\u0447\u0435\u0442 \u043F\u043E \u0442\u0430\u043B\u043E\u043D\u0430\u043C \u0437\u0430 \u043F\u0435\u0440\u0438\u043E\u0434 \u0441 ${new Date(w.value.from).toLocaleDateString()} \u043F\u043E ${new Date(w.value.to).toLocaleDateString()}`),A=c(()=>Object.keys(a.value[0]).map(h=>({name:h,required:!0,label:h,field:h,align:"left",sortable:!0}))),F={page:1,rowsPerPage:10},N=c(()=>{const h=Object.keys(a.value[0]),o={},l={};a.value.forEach(s=>{h.forEach(b=>{o[b]?o[b]+=+s[b]:o[b]=+s[b]})});const g=a.value;for(let s in o)l[s]=o[s]*D.value[s];return o.\u0414\u0430\u0442\u0430="\u0418\u0442\u043E\u0433\u043E",l.\u0414\u0430\u0442\u0430="\u0421\u0443\u043C\u043C\u0430",M(),I(o),I(l),k.value?g.filter(s=>Object.values(s).filter(b=>b.length).length>1):g}),T=V([]);function I(h){T.value.push(h)}const H=c(()=>T.value),M=()=>{T.value=[]},W=()=>{r(w.value)};return Z(()=>{u(),r(w.value)}),(h,o)=>(f(),L("div",ge,[fe,m(d)?(f(),R(le,{key:0,filled:"",modelValue:m(p),"onUpdate:modelValue":o[1]||(o[1]=l=>ee(p)?p.value=l:null),square:"",class:"date-picker"},{append:y(()=>[_(z,{name:"event",class:"cursor-pointer"},{default:y(()=>[_(ne,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:y(()=>[_(se,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=l=>t.value=l),options:m(d),range:"",minimal:""},{default:y(()=>[$("div",ye,[te(_(q,{label:"\u041E\u041A",color:"primary",flat:"",onClick:W},null,512),[[re]])])]),_:1},8,["modelValue","options"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):j("",!0),_e,m(a)&&m(d)?(f(),R(de,{key:1,title:"\u0418\u0442\u043E\u0433 \u043F\u043E \u043F\u0440\u043E\u0434\u0430\u0436\u0435 \u0442\u0430\u043B\u043E\u043D\u043E\u0432",rows:m(N),columns:m(A),class:"my-sticky-header-table","row-key":"name",pagination:F},{"top-right":y(l=>[_(me,{modelValue:k.value,"onUpdate:modelValue":o[2]||(o[2]=g=>k.value=g),label:"\u0421\u043A\u0440\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u0435",class:"toggle"},null,8,["modelValue"]),_(q,{color:"primary","icon-right":"archive",label:"XLSX","no-caps":"",onClick:o[3]||(o[3]=g=>m(i)(k.value))}),_(q,{flat:"",round:"",dense:"",icon:l.inFullscreen?"fullscreen_exit":"fullscreen",onClick:l.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])]),"bottom-row":y(()=>[(f(!0),L(O,null,X(m(H),(l,g)=>(f(),R(he,{key:g,class:"bottom-row"},{default:y(()=>[(f(!0),L(O,null,X(l,s=>(f(),R(pe,{key:s.name},{default:y(()=>[oe(ae(g==1?`${s.toLocaleString()} ${s=="\u0421\u0443\u043C\u043C\u0430"?"":"\u0440."}`:s),1)]),_:2},1024))),128))]),_:2},1024))),128))]),_:1},8,["rows","columns"])):j("",!0),m(d)?j("",!0):(f(),L("div",ke,[_(ve,{color:"primary",size:"5.5em"})]))]))}};export{$e as default};
