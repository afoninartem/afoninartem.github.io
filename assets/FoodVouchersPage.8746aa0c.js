import{h as H,j as c,t as I,v as M,A as W,r as b,C as G,ao as Q,B as J,F as K,H as m,M as S,G as n,I as B,J as p,ap as Y,O as T,K as v,ad as $,q as Z,T as j,Q as ee,R as q,N as x,L as te,P as oe}from"./index.62b09686.js";import{Q as ae,a as se,C as re}from"./ClosePopup.b31ccb4a.js";import{Q as ne}from"./QInput.142722da.js";import{a as le,Q as ce}from"./QTd.e676fa53.js";import{Q as ue}from"./QTable.fca1c974.js";import{Q as ie}from"./QSpinnerCube.c152abae.js";import"./use-dark.0e85ba3a.js";import"./use-cache.b0833c75.js";import"./use-form.62d1521a.js";import"./format.3e32b8d9.js";import"./QDialog.4d957239.js";import"./selection.663c804d.js";import"./scroll.a2ecb5a1.js";import"./use-file-dom-props.946e5f8a.js";import"./use-key-composition.4fc25fba.js";import"./QList.fc872a7b.js";import"./QChip.a306cd92.js";var de=H({name:"QTr",props:{props:Object,noHover:Boolean},setup(u,{slots:D}){const h=c(()=>"q-tr"+(u.props===void 0||u.props.header===!0?"":" "+u.props.__trClass)+(u.noHover===!0?" q-tr--no-hover":""));return()=>I("tr",{class:h.value},M(D.default))}});const E=W("vouchers",()=>{const u=b(null),D=b(null),h=b(null),{user:k}=G(),_=async()=>{await Q.get("/get-vouchers-valid-range",{headers:{Authorization:`Bearer ${k.token}`}}).then(o=>u.value=o.data.data).catch(o=>console.log(o))},g=async o=>{const r=new Date(o.from).toLocaleDateString().split(".").reverse().join("/"),f=new Date(o.to).toLocaleDateString().split(".").reverse().join("/");await Q.get("/get-vouchers-sheet-data",{headers:{Authorization:`Bearer ${k.token}`,"Date-from":r,"Date-to":f}}).then(e=>{D.value=e.data.data}).catch(e=>console.log(e)),await Q.get("/get-vouchers-price",{headers:{Authorization:`Bearer ${k.token}`}}).then(e=>h.value=e.data.data).catch(e=>console.log(e))},C=c(()=>{var o;return(o=u.value)==null?void 0:o.map(r=>r.split("T")[0].split("-").join("/"))}),V=c(()=>D.value),L=c(()=>h.value);return{getValidRange:_,getVoucherData:g,saveXLSX:async o=>{await Q.get("/download/vouchers-report",{headers:{Authorization:`Bearer ${k.token}`,"Empty-hide":`${o}`},responseType:"blob"}).then(r=>{const e=`\u041E\u0442\u0447\u0435\u0442 \u043F\u043E \u0442\u0430\u043B\u043E\u043D\u0430\u043C ${r.headers.get("Content-Type").split("; ")[1]}.xlsx`;console.log(e);const y=URL.createObjectURL(r.data),l=document.createElement("a");l.href=y,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(y)}).catch(r=>console.log(r))},validRange:C,vouchersData:V,voucherPrice:L}});const me={class:"food-vouchers"},pe=$("h4",null,"\u0422\u0430\u043B\u043E\u043D\u044B",-1),ve={class:"row items-center justify-end"},he=$("br",null,null,-1),ge={key:2,class:"loader"},Pe={__name:"FoodVouchersPage",setup(u){const{getValidRange:D,getVoucherData:h,saveXLSX:k}=E(),{validRange:_,vouchersData:g,voucherPrice:C}=J(E()),V=new Date,L=V.getDate()-V.getDay()-6,P=L+6;let o=new Date(new Date().setDate(L)),r=new Date(new Date().setDate(P));const f=b(!1),e=b({from:o,to:r}),y=c(()=>typeof e.value=="string"?{from:e.value,to:e.value}:e.value),l=c(()=>`\u041E\u0442\u0447\u0435\u0442 \u043F\u043E \u0442\u0430\u043B\u043E\u043D\u0430\u043C \u0437\u0430 \u043F\u0435\u0440\u0438\u043E\u0434 \u0441 ${new Date(y.value.from).toLocaleDateString()} \u043F\u043E ${new Date(y.value.to).toLocaleDateString()}`),O=c(()=>Object.keys(g.value[0]).map(i=>({name:i,required:!0,label:i,field:i,align:"left",sortable:!0}))),U={page:1,rowsPerPage:10},A=c(()=>{const i=Object.keys(g.value[0]),t={},s={};g.value.forEach(a=>{i.forEach(w=>{t[w]?t[w]+=+a[w]:t[w]=+a[w]})});const d=g.value;for(let a in t)s[a]=t[a]*C.value[a];return t.\u0414\u0430\u0442\u0430="\u0418\u0442\u043E\u0433\u043E",s.\u0414\u0430\u0442\u0430="\u0421\u0443\u043C\u043C\u0430",N(),X(t),X(s),f.value?d.filter(a=>Object.values(a).filter(w=>w.length).length>1):d}),R=b([]);function X(i){R.value.push(i)}const F=c(()=>R.value),N=()=>{R.value=[]},z=()=>{h(y.value)};return K(()=>{D(),h(y.value)}),(i,t)=>(m(),S("div",me,[pe,n(_)?(m(),B(ne,{key:0,filled:"",modelValue:n(l),"onUpdate:modelValue":t[1]||(t[1]=s=>Y(l)?l.value=s:null),square:"",class:"date-picker"},{append:p(()=>[v(ee,{name:"event",class:"cursor-pointer"},{default:p(()=>[v(ae,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:p(()=>[v(se,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value=s),options:n(_),range:"",minimal:""},{default:p(()=>[$("div",ve,[Z(v(j,{label:"\u041E\u041A",color:"primary",flat:"",onClick:z},null,512),[[re]])])]),_:1},8,["modelValue","options"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):T("",!0),he,n(g)&&n(_)?(m(),B(ue,{key:1,title:"\u0418\u0442\u043E\u0433 \u043F\u043E \u043F\u0440\u043E\u0434\u0430\u0436\u0435 \u0442\u0430\u043B\u043E\u043D\u043E\u0432",rows:n(A),columns:n(O),class:"my-sticky-header-table","row-key":"name",pagination:U},{"top-right":p(s=>[v(le,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=d=>f.value=d),label:"\u0421\u043A\u0440\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u0435",class:"toggle"},null,8,["modelValue"]),v(j,{color:"primary","icon-right":"archive",label:"XLSX","no-caps":"",onClick:t[3]||(t[3]=d=>n(k)(f.value))}),v(j,{flat:"",round:"",dense:"",icon:s.inFullscreen?"fullscreen_exit":"fullscreen",onClick:s.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])]),"bottom-row":p(()=>[(m(!0),S(q,null,x(n(F),(s,d)=>(m(),B(de,{key:d,class:"bottom-row"},{default:p(()=>[(m(!0),S(q,null,x(s,a=>(m(),B(ce,{key:a.name},{default:p(()=>[te(oe(d==1?`${a.toLocaleString()} ${a=="\u0421\u0443\u043C\u043C\u0430"?"":"\u0440."}`:a),1)]),_:2},1024))),128))]),_:2},1024))),128))]),_:1},8,["rows","columns"])):T("",!0),n(_)?T("",!0):(m(),S("div",ge,[v(ie,{color:"primary",size:"5.5em"})]))]))}};export{Pe as default};
