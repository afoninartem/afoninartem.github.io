import{A as V,C as F,r as m,j as v,ao as b,H as p,M as y,ad as r,K as u,J as U,Q as A,G as i,B as x,I as $,ae as g,T as B,O as S,P as Q}from"./index.752facc4.js";import{Q as R}from"./QFile.564b4131.js";import"./QChip.e39cc301.js";import"./use-dark.509a2654.js";import"./use-form.59fbe1c5.js";import"./use-file-dom-props.64605e20.js";import"./format.3e32b8d9.js";const h=V("cashlessPromotions",()=>{const{user:l}=F(),s=m(null),o=m(null),n=m(null),d=m(null),c=m(null),t=v(()=>({analysis:s.value,settlements:o.value})),k=v(()=>d.value),L=async()=>{await b.get("/cashless-promotions/consumption/download",{headers:{Authorization:`Bearer ${l.token}`},responseType:"blob"}).then(e=>{const a=e.headers.get("Content-Type");console.log(a);const w=`${new Date().toLocaleDateString()} \u0411\u0435\u0437\u043D\u0430\u043B\u0438\u0447\u043D\u044B\u0439 \u0440\u0430\u0441\u0441\u0447\u0435\u0442, \u0440\u0435\u043A\u043B\u0430\u043C\u043D\u044B\u0435 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B.xlsx`;console.log(w);const C=URL.createObjectURL(e.data),_=document.createElement("a");_.href=C,_.download=w,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(C)})},P=(e,a)=>{switch(a){case"analysis":s.value=e;break;case"settlements":o.value=e;break;case"consumption":n.value=e,D();break}},D=async()=>{if(!n.value)return;const e=new FormData;e.append("consumption",n.value),await b.post("/cashless-promotions/consumption/upload",e,{headers:{Authorization:`Bearer ${l.token}`,"Content-Type":"multipart/form-data"}}).then(a=>{c.value=a.data.data}).catch(a=>console.log(a))},T=v(()=>c.value);return{uploadFile:P,upload:async()=>{if(!t.value.analysis||!t.value.settlements)return;const e=new FormData;e.append("analysis",t.value.analysis),e.append("settlements",t.value.settlements),await b.post("/cashless-promotions/handbook/upload",e,{headers:{Authorization:`Bearer ${l.token}`,"Content-Type":"multipart/form-data"}}).then(a=>{d.value=a.data.data}).catch(a=>console.log(a))},saveXLSX:L,cashlessPromotions:T,files:t,handbookSummary:k}}),I={class:"q-pa-md"},N={class:"q-gutter-md row items-start"},f={__name:"FileUpload",props:["mode","label"],setup(l){const s=l,o=m(null),{uploadFile:n}=h();return(d,c)=>(p(),y("div",I,[r("div",N,[u(R,{modelValue:o.value,"onUpdate:modelValue":[c[0]||(c[0]=t=>o.value=t),c[1]||(c[1]=t=>i(n)(o.value,s.mode))],label:s.label,filled:"","use-chips":"",accept:".xlsx",style:{width:"400px"}},{prepend:U(()=>[u(A,{name:"attach_file"})]),_:1},8,["modelValue","label"])])]))}};const X={class:"cashless-promotions__handbook"},j=r("h4",null,"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u0440\u0435\u043A\u043B\u0430\u043C\u043D\u044B\u0445 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432, \u043F\u0440\u0438\u043E\u0431\u0440\u0435\u0442\u0435\u043D\u043D\u044B\u0445 \u0437\u0430 \u0431\u0435\u0437\u043D\u0430\u043B\u0438\u0447\u043D\u044B\u0439 \u0440\u0430\u0441\u0447\u0435\u0442",-1),z={class:"upload-section"},E={class:"summary-section"},H={__name:"HandbookCashless",setup(l){const{upload:s}=h(),{handbookSummary:o,files:n}=x(h()),d=v(()=>n.value&&n.value.analysis&&n.value.settlements);return(c,t)=>(p(),y("div",X,[j,r("section",z,[u(f,{mode:"analysis",label:"\u0410\u043D\u0430\u043B\u0438\u0437 \u0440\u0435\u043A\u043B\u0430\u043C\u043D\u043E\u0439 \u043F\u0440\u043E\u0434\u0443\u043A\u0446\u0438\u0438"}),u(f,{mode:"settlements",label:"\u0420\u0430\u0441\u0447\u0435\u0442\u044B \u0441 \u043F\u043E\u0441\u0442\u0430\u0432\u0449\u0438\u043A\u0430\u043C\u0438"}),i(d)?(p(),$(B,{key:0,class:"btn-fixed-width",color:"secondary",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",icon:"upload",style:{height:"61px"},onClick:t[0]||(t[0]=g(k=>i(s)(),["prevent"]))})):S("",!0)]),r("section",E,[r("p",null,Q(i(o)),1)])]))}};const O={class:"cashless-promotions__consumption"},q=r("h4",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0440\u0430\u0441\u0445\u043E\u0434\u0430 (\u0441\u043A\u043B\u0430\u0434\u0441\u043A\u043E\u0439 \u0443\u0447\u0435\u0442 \u041C\u041F\u0417)",-1),M={__name:"PromotionsConsumtion",setup(l){const{cashlessPromotions:s}=x(h()),{saveXLSX:o}=h();return(n,d)=>(p(),y("div",O,[q,u(f,{mode:"consumption",label:"\u0421\u043A\u043B\u0430\u0434\u0441\u043A\u043E\u0439 \u0443\u0447\u0435\u0442 \u041C\u041F\u0417"}),i(s)&&i(s).length?(p(),$(B,{key:0,class:"btn-fixed-width",color:"secondary",label:"\u0421\u043A\u0430\u0447\u0430\u0442\u044C",icon:"download",onClick:g(i(o),["prevent"])},null,8,["onClick"])):S("",!0)]))}},G={class:"cashless-promotions"},J={class:"cashless-promotions__handbook"},K={class:"cashless-promotions__consumption"},ne={__name:"CashlessPromotions",setup(l){return(s,o)=>(p(),y("div",G,[r("div",J,[u(H)]),r("div",K,[u(M)])]))}};export{ne as default};
