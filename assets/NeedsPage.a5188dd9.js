import{Z as F,D as R,r as N,a as $,aq as U,p as _,y as b,z as E,v as l,t as r,aN as A,af as i,B as m,A as f,q as k,d as T,E as w,x as q,F as I,Q as j,s as H,m as O,u as C}from"./index.f7b09357.js";import{a as S,Q as Z}from"./QCard.c96cc3ce.js";import{Q as G}from"./QSeparator.54e782e6.js";import{Q as z}from"./QDate.41572ad5.js";import{Q as J}from"./QCardActions.2fe9c940.js";import{C as L,Q as K}from"./ClosePopup.8ade68de.js";import{Q}from"./QInput.ba44d331.js";import{u as W}from"./use-quasar.239d3934.js";import"./use-dark.7584776e.js";import"./use-render-cache.1a7235d4.js";import"./use-form.927c5f98.js";import"./format.3e32b8d9.js";import"./QDialog.5b8411ea.js";import"./use-prevent-scroll.998b213e.js";import"./scroll.4fa8745d.js";import"./selection.a82ce445.js";import"./position-engine.16a41f35.js";import"./QMenu.bb5f443a.js";import"./use-file-dom-props.5ca1b415.js";import"./use-key-composition.71287be3.js";const P=F("needs",()=>{const{user:x}=R(),v=N([]),y=async()=>{await U.get("/advertising/needs/all",{headers:{Authorization:`Bearer ${x.token}`}}).then(e=>v.value=e.data.data).catch(e=>console.log(e))},s=async(e,c)=>{await U.post(`/advertising/needs/${e}`,{...c},{headers:{Authorization:`Bearer ${x.token}`}}).then(M=>{y(),console.log(M)})},h=$(()=>{let e=0;return v.value.forEach(c=>{c.is_ordered||e++}),e}),p=$(()=>v.value),n=$(()=>p.value.filter(e=>!e.is_ordered&&!e.is_postponed&&!e.is_denied)),d=$(()=>p.value.filter(e=>e.is_ordered==!0)),V=$(()=>p.value.filter(e=>e.is_postponed==!0)),u=$(()=>p.value.filter(e=>e.is_denied==!0));return{totalreqs:h,needs:p,reqs:n,ords:d,postedreqs:V,deniedreqs:u,allneeds:y,handle:s}}),X={class:"text-h6"},Y={class:"text-subtitle2"},ee={key:0,class:"text-subtitle2"},te={key:1,class:"text-subtitle2"},se={key:2,class:"text-subtitle2"},oe={class:"text-subtitle1"},ae={class:"text-subtitle1"},le={class:"text-subtitle1"},D={__name:"NeedCard",props:["needs"],setup(x){const{handle:v}=P(),y=x,s=N(""),h=o=>{let a=new Date(new Date().setDate(new Date(s.value).getDate())).toISOString();o.postponed_date=a,v("postpone",o),o.toPostpone=!1},p=o=>{o=new Date(o);let a=new Date,t=o-a;return Math.ceil(t/(1e3*60*60*24))},n=o=>{let a=Math.abs(o)+" "+d(o);return o>=0?"\u041E\u0441\u0442\u0430\u043B\u043E\u0441\u044C "+a:"\u041F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D\u043E \u043D\u0430 "+a},d=o=>{const a="\u0434\u0435\u043D\u044C";var t="";switch(o%10){case 1:t=a;break;case 2:case 3:case 4:t="\u0434\u043D\u044F";break;default:t="\u0434\u043D\u0435\u0439"}return t},V=o=>{let a="background: ";return o.is_postponed&&(a+="#5476f0"),o.is_denied&&(a+="#C10015"),o.is_ordered&&(a+="#21BA45"),!o.is_ordered&&!o.is_denied&&!o.is_postponed&&(a+="#F2C037"),a},u=N(null),e=(o,a)=>{u.value=setTimeout(()=>{M(o,a)},1e3)},c=()=>{clearTimeout(u.value)},M=(o,a)=>{if(o=="postpone"){a.toPostpone=!a.toPostpone;return}v(o,a)};return(o,a)=>(_(!0),b(I,null,E(y.needs,(t,B)=>(_(),b("div",{class:"needs__card",key:`i-${B}`},[l(Z,{class:"my-card"},{default:r(()=>[l(S,{class:"text-white",style:A(V(t))},{default:r(()=>[i("div",X,m(t.name),1),i("div",Y,"\u0417\u0430\u044F\u0432\u043A\u0430 \u043E\u0442 "+m(t.request_date_str),1),t.is_postponed?(_(),b("div",ee,"\u041E\u0442\u043B\u043E\u0436\u0435\u043D\u0430 \u0434\u043E "+m(t.postponed_date_str),1)):f("",!0),t.is_denied?(_(),b("div",te,"\u041E\u0442\u043A\u043B\u043E\u043D\u0435\u043D\u0430 "+m(t.denied_date_str),1)):f("",!0),t.is_ordered?(_(),b("div",se,"\u0417\u0430\u043A\u0430\u0437 \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D "+m(t.order_date_str),1)):f("",!0)]),_:2},1032,["style"]),l(S,null,{default:r(()=>[i("div",oe,"\u041E\u0441\u0442\u0430\u0442\u043E\u043A \u043D\u0430 \u0434\u0435\u043D\u044C \u0437\u0430\u043A\u0430\u0437\u0430: "+m(Number(t.leftover).toLocaleString("ru-RU")),1),i("div",ae,"\u0417\u0430\u043A\u0430\u0437\u0430\u0442\u044C: "+m(Number(t.amount).toLocaleString("ru-RU")),1),i("div",le,"\u0414\u043E\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0434\u043E: "+m(t.delivery_date_str),1)]),_:2},1024),l(S,null,{default:r(()=>[i("div",{class:"text-subtitle1",style:A(p(t.delivery_date)>0?null:"color: red")},m(n(p(t.delivery_date))),5)]),_:2},1024),l(G,{dark:""}),t.toPostpone?(_(),k(z,{key:0,modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=g=>s.value=g),minimal:""},{default:r(()=>[s.value.length>0?T((_(),k(w,{key:0,label:"\u041E\u043A",color:"primary",flat:"",onClick:g=>h(t)},null,8,["onClick"])),[[L]]):f("",!0)]),_:2},1032,["modelValue"])):f("",!0),l(J,{style:{display:"flex","justify-content":"space-between"}},{default:r(()=>[t.is_ordered?f("",!0):(_(),k(w,{key:0,class:"y",onMousedown:g=>e("order",t),onMouseup:c,onMouseleave:c},{default:r(()=>[q("\u0417\u0430\u043A\u0430\u0437\u0430\u043D\u043E")]),_:2},1032,["onMousedown"])),t.is_ordered?(_(),k(w,{key:1,class:"y",onMousedown:g=>e("accept",t),onMouseup:c,onMouseleave:c},{default:r(()=>[q("\u041F\u0440\u0438\u043D\u044F\u0442\u043E")]),_:2},1032,["onMousedown"])):f("",!0),t.is_ordered?f("",!0):(_(),k(w,{key:2,class:"w",onClick:g=>M("postpone",t)},{default:r(()=>[q("\u041E\u0442\u043B\u043E\u0436\u0438\u0442\u044C ")]),_:2},1032,["onClick"])),t.is_ordered?f("",!0):(_(),k(w,{key:3,class:"n",onMousedown:g=>e("deny",t),onMouseup:c,onMouseleave:c},{default:r(()=>[q("\u041E\u0442\u043A\u0430\u0437\u0430\u043D\u043E")]),_:2},1032,["onMousedown"])),t.is_ordered?(_(),k(w,{key:4,class:"n",onMousedown:g=>e("back",t),onMouseup:c,onMouseleave:c},{default:r(()=>[q("\u041E\u0442\u043C\u0435\u043D\u0430")]),_:2},1032,["onMousedown"])):f("",!0)]),_:2},1024)]),_:2},1024)]))),128))}};const ne={class:"container"},re={class:"need__form q-gutter-md",style:{"max-width":"900px"}},de={class:"row items-center justify-end"},ue={__name:"NeedForm",setup(x){const v=W(),{handle:y}=P(),s=N({}),h=()=>{(s.value.name.length==0||s.value.amount.length==0||s.value.leftover.length==0||s.value.delivery_date.length==0)&&v.notify("\u0412\u0441\u0435 \u043F\u043E\u043B\u044F \u0444\u043E\u0440\u043C\u044B \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B \u043A \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044E");let p=s.value,n=s.value.delivery_date;p.delivery_date=new Date(n),y("new",s.value),s.value={}};return(p,n)=>(_(),b("div",ne,[i("div",re,[l(Q,{outlined:"",modelValue:s.value.name,"onUpdate:modelValue":n[0]||(n[0]=d=>s.value.name=d),label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0438\u0437 1\u04217.7"},null,8,["modelValue"]),l(Q,{type:"number",outlined:"",modelValue:s.value.leftover,"onUpdate:modelValue":n[1]||(n[1]=d=>s.value.leftover=d),label:"\u041E\u0441\u0442\u0430\u0442\u043E\u043A \u043D\u0430 \u0434\u0435\u043D\u044C \u0437\u0430\u044F\u0432\u043A\u0438"},null,8,["modelValue"]),l(Q,{type:"number",outlined:"",modelValue:s.value.amount,"onUpdate:modelValue":n[2]||(n[2]=d=>s.value.amount=d),label:"\u0421\u043A\u043E\u043B\u044C\u043A\u043E \u043D\u0430\u0434\u043E \u0437\u0430\u043A\u0430\u0437\u0430\u0442\u044C"},null,8,["modelValue"]),l(Q,{outlined:"",modelValue:s.value.delivery_date,"onUpdate:modelValue":n[4]||(n[4]=d=>s.value.delivery_date=d),rules:["date"],label:"\u041A\u043E\u0433\u0434\u0430 \u0434\u043E\u0441\u0442\u0430\u0432\u0438\u0442\u044C"},{append:r(()=>[l(j,{name:"event",class:"cursor-pointer"},{default:r(()=>[l(K,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[l(z,{modelValue:s.value.delivery_date,"onUpdate:modelValue":n[3]||(n[3]=d=>s.value.delivery_date=d)},{default:r(()=>[i("div",de,[T(l(w,{label:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C",color:"primary",flat:""},null,512),[[L]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l(w,{onClick:h,color:"secondary",flat:""},{default:r(()=>[q("\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0437\u0430\u044F\u0432\u043A\u0443")]),_:1})]))}};const ie={class:"needs"},ce={class:"needs__container q-pa-md row items-start q-gutter-md"},_e={class:"requests"},pe={style:{"font-weight":"600","font-size":"20px"}},me={class:"cards q-pa-md row items-start q-gutter-md"},ve={class:"orders"},fe={style:{"font-weight":"600","font-size":"20px"}},ye={class:"cards q-pa-md row items-start q-gutter-md"},ze={__name:"NeedsPage",setup(x){const{reqs:v,postedreqs:y,deniedreqs:s,ords:h,totalreqs:p}=H(P()),{allneeds:n}=P(),d=()=>{let u="\u0412 \u043E\u0436\u0438\u0434\u0430\u043D\u0438\u0438 \u0437\u0430\u043A\u0430\u0437\u0430 ",e=p.value;switch(e%10){case 1:u+=e+" \u0437\u0430\u044F\u0432\u043A\u0430:";break;case 2:case 3:case 4:u+=e+" \u0437\u0430\u044F\u0432\u043A\u0438:";break;default:u+=e+" \u0437\u0430\u044F\u0432\u043E\u043A:"}return u},V=()=>{let u="\u0412 \u0440\u0430\u0431\u043E\u0442\u0435 ",e=Array.from(h.value).length;switch(e%10){case 1:u+=e+" \u0437\u0430\u043A\u0430\u0437:";break;case 2:case 3:case 4:u+=e+" \u0437\u0430\u043A\u0430\u0437\u0430:";break;default:u+=e+" \u0437\u0430\u043A\u0430\u0437\u043E\u0432:"}return u};return O(()=>{n()}),(u,e)=>(_(),b("div",ie,[l(ue),i("div",ce,[i("div",_e,[i("div",pe,m(d()),1),i("div",me,[l(D,{needs:C(v)},null,8,["needs"]),l(D,{needs:C(y)},null,8,["needs"]),l(D,{needs:C(s)},null,8,["needs"])])]),i("div",ve,[i("div",fe,m(V()),1),i("div",ye,[l(D,{needs:C(h)},null,8,["needs"])])])])]))}};export{ze as default};
