import{Z as B,D as L,r as g,a as V,aq as $,aY as q,_ as A,p,y as w,af as r,v as f,t as I,Q as T,s as U,q as E,ag as F,E as Q,A as b,u as h}from"./index.35d82f09.js";import{Q as M}from"./QInput.28946e4d.js";import{Q as N}from"./QTable.4e9f67ec.js";import{Q as R}from"./QFile.9bf69975.js";import{A as X}from"./ArtisLoader.76029ad1.js";import{u as O}from"./use-quasar.73d3c6a1.js";import"./private.use-form.4fe4fd93.js";import"./use-dark.c29fb982.js";import"./use-file-dom-props.facefcf3.js";import"./use-key-composition.251259c9.js";import"./QSeparator.85be54f9.js";import"./QList.63b6b0a6.js";import"./scroll.9b015c40.js";import"./QChip.b40063c3.js";import"./QItem.de2a3412.js";import"./QMenu.30a5985d.js";import"./position-engine.e8d411f3.js";import"./selection.4607d80c.js";import"./QDialog.bf617026.js";import"./use-prevent-scroll.d44500c6.js";import"./format.de7e9769.js";import"./QLinearProgress.ea1db2ce.js";import"./QSpinnerCube.c5ef6b1c.js";const S=B("materialConsumption",()=>{const{user:m}=L(),a=g(null),d=g(null),c=e=>{a.value=e},y=async()=>{if(!a.value)return;const e=new FormData;e.append("materialConsumption",a.value),await $.post("/accounting/material-consumption/upload",e,{headers:{Authorization:`Bearer ${m.token}`,"Content-Type":"multipart/form-data"}}).then(t=>{console.log(t.data),d.value=t.data.data}).catch(t=>console.log(t))},C=async e=>{console.log(e,typeof e),localStorage.setItem("coefficient",JSON.stringify(e));const t=new FormData;t.append("coefficient",e),await $.post("/accounting/material-consumption/coefficient",t,{headers:{Authorization:`Bearer ${m.token}`,"Content-Type":"multipart/form-data"}}).then(s=>{console.log(s.data),d.value=s.data.data}).catch(s=>console.log(s))},_=V(()=>{if(!d.value)return null;const e=new Object;e.columns=[],e.rows=[];const t={name:"article",required:!0,label:"\u0410\u0440\u0442\u0438\u043A\u0443\u043B",align:"left",field:"article",format:l=>`${l}`,sortable:!0},s={name:"unit",required:!0,label:"\u0415\u0434\u0438\u043D\u0438\u0446\u0430 \u0438\u0437\u043C.",align:"left",field:"unit",format:l=>`${l}`,sortable:!0};return e.columns.push(t,s),Array.from(d.value).forEach((l,v)=>{const n=`amount-${v}`,i=`\u041A\u043E\u044D\u0444\u0444 = ${l.coefficient}`;e.columns.push({name:"unit",required:!0,label:i,align:"left",field:n,format:o=>`${o}`,sortable:!1}),l.result_items.forEach(o=>{const k=e.rows.filter(x=>x.article==o.article);k.length?k[0][n]=o.amount:(o[n]=o.amount,e.rows.push(o))})}),e}),u=async e=>{q.set("coefficient",e),await $.get("/accounting/material-consumption/download",{headers:{Authorization:`Bearer ${m.token}`,Coefficient:`${e}`},responseType:"blob"}).then(t=>{const s=t.headers.get("Content-Type");console.log(s);const l=`\u0420\u0430\u0441\u0445\u043E\u0434 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432 \u0441 \u043A\u043E\u044D\u0444\u0444\u0438\u0446\u0438\u0435\u043D\u0442\u043E\u043C ${e}.xlsx`;console.log(l);const v=URL.createObjectURL(t.data),n=document.createElement("a");n.href=v,n.download=l,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(v)}).catch(t=>console.log(t))};return{uploadFile:c,upload:y,saveXLSX:u,calculate:C,saveXLSX:u,preview:_,inputFile:a}}),D={setup(){const m=g(null),{uploadFile:a}=S();return{file:m,uploadFile:a}}},j={class:"q-pa-md"},z={class:"q-gutter-md row items-start"};function J(m,a,d,c,y,C){return p(),w("div",j,[r("div",z,[f(R,{modelValue:c.file,"onUpdate:modelValue":[a[0]||(a[0]=_=>c.file=_),a[1]||(a[1]=_=>c.uploadFile(c.file))],label:"\u0420\u0430\u0441\u0445\u043E\u0434 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432",filled:"","use-chips":"",accept:".xlsx",style:{"max-width":"300px"}},{prepend:I(()=>[f(T,{name:"attach_file"})]),_:1},8,["modelValue"])])])}var K=A(D,[["render",J]]);const P={class:"material-consumption"},Y=r("h4",{class:"material-consumption__title"},"\u0420\u0430\u0441\u0445\u043E\u0434 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432",-1),Z={class:"material-consumption__content"},G={key:0,class:"upload-file"},H=r("div",{class:"material-consumption__description"},[r("p",null,"\u0412\u044B\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0438\u0437 1\u0421:\u0411\u0443\u0445\u0433\u0430\u043B\u0442\u0435\u0440\u0438\u044F \u043E\u0442\u0447\u0435\u0442 \u0420\u0430\u0441\u0445\u043E\u0434 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432."),r("p",null,"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435 XLSX."),r("p",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0432\u0448\u0438\u0439\u0441\u044F \u0444\u0430\u0439\u043B \u0432 \u043E\u043A\u043D\u043E \u043D\u0438\u0436\u0435.")],-1),W={class:"material-consumption__upload"},ee={key:1,class:"results"},te={class:"results__add-coeff"},oe=r("h6",null,"\u0414\u043B\u044F \u0441\u043A\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u0430 \u043D\u0430\u0436\u043C\u0438\u0442\u0435 \u043D\u0430 \u043B\u044E\u0431\u043E\u0439 \u0441\u0442\u0440\u043E\u043A\u0435 \u043F\u043E\u0434 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u043C \u043A\u043E\u044D\u0444\u0444\u0438\u0446\u0435\u043D\u0442\u043E\u043C.",-1),ae={key:2,class:"results__preview"},ne={key:3,class:"loader"},Qe={__name:"MaterialsConsumption",setup(m){const a=O();let d=JSON.parse(a.localStorage.getItem("coefficient"))||.8;const{upload:c,calculate:y,saveXLSX:C}=S(),{inputFile:_,preview:u}=U(S()),e=g(!1),t=g(d),s=(n,i)=>{const o=n.target.cellIndex;if(o<2)return;const x=u.value.columns[o].label.split("= ")[1];C(x)},l=()=>{e.value=!0},v=V(()=>Boolean(_.value)&&!e.value);return(n,i)=>(p(),w("div",P,[Y,r("section",Z,[e.value?b("",!0):(p(),w("article",G,[H,r("div",W,[f(K)]),v.value?(p(),E(Q,{key:0,class:"btn-fixed-width",color:"secondary",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",icon:"upload",onClick:i[0]||(i[0]=F(o=>{h(c)(),l()},["prevent"]))})):b("",!0)])),e.value?(p(),w("article",ee,[r("div",te,[f(M,{modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=o=>t.value=o),modelModifiers:{number:!0},type:"number",filled:"",style:{"max-width":"200px"}},null,8,["modelValue"]),f(Q,{class:"btn-fixed-width",color:"secondary",label:"\u0420\u0430\u0441\u0441\u0447\u0438\u0442\u0430\u0442\u044C",onClick:i[2]||(i[2]=F(o=>h(y)(t.value),["prevent"]))})]),oe])):b("",!0),h(u)?(p(),w("article",ae,[f(N,{title:"\u041F\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0439 \u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440 (\u043F\u043E \u043E\u0434\u043D\u043E\u043C\u0443 \u0430\u0440\u0442\u0438\u043A\u0443\u043B\u0443 \u043D\u0430 \u0435\u0434\u0438\u043D\u0438\u0446\u0443 \u0438\u0437\u043C\u0435\u0440\u0435\u043D\u0438\u044F)",rows:h(u).rows,columns:h(u).columns,onRowClick:s,"row-key":"name","hide-pagination":!0,"rows-per-page-options":[0]},null,8,["rows","columns"])])):b("",!0),e.value&&!h(u)?(p(),w("article",ne,[f(X)])):b("",!0)])]))}};export{Qe as default};
