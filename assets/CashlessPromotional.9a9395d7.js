import{Q as J,a as G,b as q,c as D}from"./QTabPanels.6fd44729.js";import{X as K,D as W,r as h,a as w,ao as V,p as b,y as B,ad as r,v as e,t as u,Q as I,u as f,s as P,E as x,q as $,x as z,B as A,A as Q,ae as H,w as Y,m as Z}from"./index.36d0b482.js";import{Q as ee}from"./QExpansionItem.98696b35.js";import{Q as se}from"./QFile.633af9bd.js";import{Q as L}from"./QInput.e513b8db.js";import{Q as te}from"./QToggle.2b598fc9.js";import{Q as U}from"./QTd.10f2724a.js";import{Q as N}from"./QTable.52683ab3.js";import"./use-form.7f75854f.js";import"./use-dark.cc47ea02.js";import"./QResizeObserver.22ca36c7.js";import"./position-engine.6c7f8a4d.js";import"./selection.d97ab783.js";import"./scroll.10ab085c.js";import"./QMenu.b3dbd1a5.js";import"./QDialog.0d6eb48a.js";import"./use-prevent-scroll.9143d7a8.js";import"./touch.3df10340.js";import"./use-render-cache.1a7235d4.js";import"./QItem.1f8eb1ea.js";import"./QSeparator.b21a15b8.js";import"./QChip.a10ba570.js";import"./use-file-dom-props.3b45cb4a.js";import"./format.3e32b8d9.js";import"./use-key-composition.988c7d52.js";import"./QList.baa58d36.js";import"./QLinearProgress.e44631f6.js";const g=K("cashlessPromotional",()=>{const{user:_}=W(),d=h(null),n=h(null),l=h(null),c=h(null),o=h(null),m=h(null),y=h(null),v=h(null),s=w(()=>({analysis:d.value,settlements:n.value,turningSheet1012:l.value,turningSheet4106:c.value,consumption:o.value})),p=w(()=>m.value),a=async()=>{await V.get("/accounting/cashless-promotions/result/download",{headers:{Authorization:`Bearer ${_.token}`},responseType:"blob"}).then(t=>{const i=t.headers.get("Content-Type");console.log(i);const C=`${new Date().toLocaleDateString()} \u0411\u0435\u0437\u043D\u0430\u043B\u0438\u0447\u043D\u044B\u0439 \u0440\u0430\u0441\u0441\u0447\u0435\u0442, \u0440\u0435\u043A\u043B\u0430\u043C\u043D\u044B\u0435 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B.xlsx`;console.log(C);const X=URL.createObjectURL(t.data),S=document.createElement("a");S.href=X,S.download=C,document.body.appendChild(S),S.click(),document.body.removeChild(S),window.URL.revokeObjectURL(X)})},k=(t,i)=>{switch(i){case"analysis":d.value=t;break;case"settlements":n.value=t;break;case"10.12":l.value=t;break;case"41.06":c.value=t;break;case"consumption":o.value=t;break}},E=async(t=0)=>{if(!o.value)return;const i=new FormData;i.append("consumption",o.value),await V.post("/accounting/cashless-promotions/consumption/upload",i,{headers:{Authorization:`Bearer ${_.token}`,"Content-Type":"multipart/form-data",Sum:t}}).then(C=>{v.value=C.data.data}).catch(C=>console.log(C))},R=w(()=>v.value),F=async()=>{await V.get("/accounting/cashless-promotional/handbook",{headers:{Authorization:`Bearer ${_.token}`}}).then(t=>{y.value=t.data.data}).catch(t=>console.log(t))},O=async()=>{const t=new FormData;t.append("analysis",s.value.analysis),t.append("settlements",s.value.settlements),t.append("10.12",s.value.turningSheet1012),t.append("41.06",s.value.turningSheet4106),await V.post("/accounting/cashless-promotional/handbook/upload",t,{headers:{Authorization:`Bearer ${_.token}`,"Content-Type":"multipart/form-data"}}).then(i=>{m.value=i.data.data}).catch(i=>console.log(i))},j=w(()=>y.value),M=w(()=>y.value.data.filter(i=>i.user_cashless));return{uploadFile:k,upload:O,saveXLSX:a,uploadConsumption:E,getHandbook:F,updateHB:async t=>{await V.post("/accounting/cashless-promotional/handbook/update",{...t},{headers:{Authorization:`Bearer ${_.token}`}}).then(i=>{F()}).catch(i=>console.log(i))},resetCashless:async t=>{await V.post("/accounting/cashless-promotional/handbook/resetCashless",{...t},{headers:{Authorization:`Bearer ${_.token}`}}).then(i=>{F()}).catch(i=>console.log(i))},userHB:M,actualHB:j,consumption:o,cashlessPromotional:R,files:s,handbookSummary:p}}),oe={class:"q-pa-md"},ae={class:"q-gutter-md row items-start"},T={__name:"FileUploadTXT",props:["mode","label"],setup(_){const d=_,n=h(null),{uploadFile:l}=g();return(c,o)=>(b(),B("div",oe,[r("div",ae,[e(se,{modelValue:n.value,"onUpdate:modelValue":[o[0]||(o[0]=m=>n.value=m),o[1]||(o[1]=m=>f(l)(n.value,d.mode))],label:d.label,square:"",filled:"","use-chips":"",accept:".txt",style:{width:"400px"}},{prepend:u(()=>[e(I,{name:"attach_file"})]),_:1},8,["modelValue","label"])])]))}};const ne={key:0,class:"cashless-promotions__table"},le={__name:"HandbookTable",setup(_){const{updateHB:d,getHandbook:n}=g(),{actualHB:l}=P(g()),c=h(""),o=[["name","\u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B"],["cash_incomes","\u041F\u043E\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0439 \u0437\u0430 \u043D\u0430\u043B\u0438\u0447\u043D\u044B\u0435"],["cashless_incomes","\u041F\u043E\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0439 \u043F\u043E \u0411/\u041D"],["cashless_percent","% \u0411/\u041D"],["is_cashless","\u0421\u0442\u0430\u0442\u0443\u0441 \u0411/\u041D"]],m=async s=>{await d(s)},y=w(()=>o.map(s=>({name:s[0],required:!0,label:s[1],field:s[0],format:p=>s[0]=="cashless_percent"?`${p} %`:`${p}`,align:"left",sortable:!0}))),v={page:1,rowsPerPage:0};return(s,p)=>f(l)?(b(),B("div",ne,[e(N,{title:"\u0420\u0435\u043A\u043B\u0430\u043C\u043D\u044B\u0435 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B",rows:f(l).data,columns:y.value,class:"my-sticky-header-table","row-key":"name",pagination:v,filter:c.value},{"top-right":u(a=>[e(L,{dense:"",debounce:"300",modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=k=>c.value=k),name:"search",placeholder:"\u041F\u043E\u0438\u0441\u043A"},{append:u(()=>[e(I,{name:"search"})]),_:1},8,["modelValue"]),e(x,{flat:"",round:"",dense:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen",onClick:a.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])]),"body-cell-is_cashless":u(a=>[typeof a.row.is_cashless=="boolean"?(b(),$(U,{key:0,props:a},{default:u(()=>[e(te,{name:a.row.name,modelValue:a.row.is_cashless,"onUpdate:modelValue":[k=>a.row.is_cashless=k,k=>m(a.row)],size:"xs",color:"green"},null,8,["name","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])):(b(),$(U,{key:1,props:a},{default:u(()=>[z(A(a.row.is_cashless),1)]),_:2},1032,["props"]))]),_:1},8,["rows","columns","filter"])])):Q("",!0)}};const ce={class:"cashless-promotions__handbook"},re={class:"upload-section"},ie={class:"upload-section__turning-sheets"},ue={class:"upload-section__reports"},de={class:"summary-section"},me={class:"table-section"},pe={__name:"HandbookCashless",setup(_){const{upload:d}=g(),{handbookSummary:n,files:l}=P(g()),c=w(()=>l.value&&l.value.analysis&&l.value.settlements&&l.value.turningSheet1012&&l.value.turningSheet4106);return(o,m)=>(b(),B("div",ce,[e(ee,{label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0434\u043B\u044F \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430",width:"100%"},{default:u(()=>[r("section",re,[r("div",ie,[e(T,{mode:"10.12",label:"\u041E\u0431\u043E\u0440\u043E\u0442\u043D\u043E-\u0441\u0430\u043B\u044C\u0434\u043E\u0432\u0430\u044F \u0432\u0435\u0434\u043E\u043C\u043E\u0441\u0442\u044C \u043F\u043E \u0441\u0447\u0435\u0442\u0443 10.12.txt"}),e(T,{mode:"41.06",label:"\u041E\u0431\u043E\u0440\u043E\u0442\u043D\u043E-\u0441\u0430\u043B\u044C\u0434\u043E\u0432\u0430\u044F \u0432\u0435\u0434\u043E\u043C\u043E\u0441\u0442\u044C \u043F\u043E \u0441\u0447\u0435\u0442\u0443 41.06.txt"})]),r("div",ue,[e(T,{mode:"analysis",label:"TXT \u0410\u043D\u0430\u043B\u0438\u0437 \u0440\u0435\u043A\u043B\u0430\u043C\u043D\u043E\u0439 \u043F\u0440\u043E\u0434\u0443\u043A\u0446\u0438\u0438"}),e(T,{mode:"settlements",label:"TXT \u0420\u0430\u0441\u0447\u0435\u0442\u044B \u0441 \u043F\u043E\u0441\u0442\u0430\u0432\u0449\u0438\u043A\u0430\u043C\u0438"})]),c.value?(b(),$(x,{key:0,class:"btn-fixed-width",color:"secondary",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",icon:"upload",style:{height:"61px"},onClick:m[0]||(m[0]=H(y=>f(d)(),["prevent"]))})):Q("",!0)])]),_:1}),r("section",de,[r("p",null,A(f(n)),1)]),r("section",me,[e(le)])]))}};const _e={class:"cashless-promotions__consumption"},he={class:"upload-section"},be={class:"inputs"},ve={class:"buttons"},fe={__name:"PromotionalConsumption",setup(_){const{cashlessPromotional:d,files:n}=P(g()),{uploadConsumption:l,saveXLSX:c}=g(),o=h(null),m=w(()=>n.value&&n.value.consumption);return(y,v)=>(b(),B("div",_e,[r("section",he,[r("div",be,[e(T,{mode:"consumption",label:"\u0421\u043A\u043B\u0430\u0434\u0441\u043A\u043E\u0439 \u0443\u0447\u0435\u0442 \u041C\u041F\u0417"}),e(L,{modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=s=>o.value=s),modelModifiers:{number:!0},type:"number",label:"\u041E\u043F\u0446\u0438\u043E\u043D\u0430\u043B\u044C\u043D\u043E: 1% \u0432\u044B\u0440\u0443\u0447\u043A\u0438",square:"",filled:"",style:{width:"400px"}},null,8,["modelValue"])]),r("div",ve,[m.value?(b(),$(x,{key:0,class:"btn-fixed-width",color:"secondary",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",icon:"upload",style:{height:"61px"},onClick:v[1]||(v[1]=H(s=>f(l)(o.value),["prevent"]))})):Q("",!0),f(d)&&f(d).length?(b(),$(x,{key:1,class:"btn-fixed-width",color:"secondary",label:"\u0421\u043A\u0430\u0447\u0430\u0442\u044C",icon:"download",style:{height:"61px"},onClick:H(f(c),["prevent"])},null,8,["onClick"])):Q("",!0)])])]))}},ge={__name:"UserHandbookTable",setup(_){const{getHandbook:d,resetCashless:n}=g(),{userHB:l}=P(g()),c=h(""),o=[["name","\u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B"],["cash_incomes","\u041F\u043E\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0439 \u0437\u0430 \u043D\u0430\u043B\u0438\u0447\u043D\u044B\u0435"],["cashless_incomes","\u041F\u043E\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0439 \u043F\u043E \u0411/\u041D"],["cashless_percent","% \u0411/\u041D"],["is_cashless","\u0411/\u041D \u0438\u043B\u0438 \u041D\u0410\u041B"],["user_cashless","\u0423\u0434\u0430\u043B\u0438\u0442\u044C"]],m=async s=>{await n(s)},y=w(()=>o.map(s=>({name:s[0],required:!0,label:s[1],field:s[0],format:p=>s[0]=="cashless_percent"?`${p} %`:s[0]=="is_cashless"?p?"\u0411/\u041D":"\u041D\u0410\u041B":`${p}`,align:"left",sortable:!0}))),v={page:1,rowsPerPage:0};return(s,p)=>(b(),$(N,{title:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0431\u0435\u0437\u043D\u0430\u043B\u0438\u0447\u043D\u043E\u0441\u0442\u0438",rows:f(l),columns:y.value,class:"my-sticky-header-table","row-key":"name",pagination:v,filter:c.value},{"top-right":u(a=>[e(L,{dense:"",debounce:"300",modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=k=>c.value=k),name:"search",placeholder:"\u041F\u043E\u0438\u0441\u043A"},{append:u(()=>[e(I,{name:"search"})]),_:1},8,["modelValue"]),e(x,{flat:"",round:"",dense:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen",onClick:a.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])]),"body-cell-user_cashless":u(a=>[typeof a.row.user_cashless=="boolean"?(b(),$(U,{key:0,props:a},{default:u(()=>[e(x,{icon:"delete",color:"primary",onClick:H(k=>m(a.row),["prevent"])},null,8,["onClick"])]),_:2},1032,["props"])):(b(),$(U,{key:1,props:a},{default:u(()=>[z(A(a.row.user_cashless),1)]),_:2},1032,["props"]))]),_:1},8,["rows","columns","filter"]))}};const ye={class:"cashless-promotional"},ke=r("h4",null,"\u0420\u0430\u0441\u0447\u0435\u0442 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432 \u0434\u043B\u044F \u0411\u041F",-1),we=r("p",null,"\u0414\u043B\u044F \u0440\u0430\u0441\u0447\u0435\u0442\u0430 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442 \u043E\u0442\u0447\u0435\u0442\u0430 \u0421\u043A\u043B\u0430\u0434\u0441\u043A\u043E\u0439 \u0443\u0447\u0435\u0442 \u041C\u041F\u0417 \u0432 1\u04217.7 \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435 xls.",-1),$e=r("p",null,"\u0422\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u043D\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0441\u0443\u043C\u043C\u0443, \u043A\u043E\u0442\u043E\u0440\u0443\u044E \u043D\u0430\u0434\u043E \u0440\u0430\u0441\u043F\u0440\u0435\u0434\u0435\u043B\u0438\u0442\u044C \u043C\u0435\u0436\u0434\u0443 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u0430\u043C\u0438 (\u043E\u043F\u0446\u0438\u043E\u043D\u0430\u043B\u044C\u043D\u043E).",-1),Ce=r("h4",null,"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u0440\u0435\u043A\u043B\u0430\u043C\u043D\u044B\u0445 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432",-1),Ve=r("p",null,"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u0442 \u0441\u043F\u0438\u0441\u043E\u043A \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432 \u0441 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u044B\u043C\u0438 \u0434\u043B\u044F \u0437\u0430\u0434\u0430\u0447\u0438 \u043F\u0440\u0438\u0437\u043D\u0430\u043A\u0430\u043C\u0438.",-1),xe=r("p",null,"\u041D\u0430 \u044D\u0442\u043E\u0439 \u0432\u043A\u043B\u0430\u0434\u043A\u0435 \u043C\u043E\u0436\u043D\u043E \u043F\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u0441\u0432\u0435\u0436\u0435\u0439 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0435\u0439 \u043F\u043E \u043F\u043E\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u044F\u043C \u0438 \u043E\u0437\u043D\u0430\u043A\u043E\u043C\u0438\u0442\u044C\u0441\u044F \u0441 \u043E\u0431\u0437\u043E\u0440\u043E\u043C \u043F\u043E \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u0430\u043C.",-1),Se=r("p",null,'\u0422\u0430\u043A\u0436\u0435 \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 "\u0431\u0435\u0437\u043D\u0430\u043B\u0438\u0447\u043D\u043E\u0441\u0442\u0438" \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u0430, \u0435\u0441\u043B\u0438 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F.',-1),Te=r("h4",null,"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",-1),Be=r("p",null,'\u0421\u043F\u0438\u0441\u043E\u043A \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432, \u043F\u0440\u0438\u0437\u043D\u0430\u043A "\u0431\u0435\u0437\u043D\u0430\u043B\u0438\u0447\u043D\u043E\u0441\u0442\u0438" \u043A\u043E\u0442\u043E\u0440\u044B\u0445 \u0431\u044B\u043B \u0438\u0437\u043C\u0435\u043D\u0435\u043D \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u043C.',-1),Qe=r("p",null,'\u0427\u0442\u043E\u0431\u044B \u043F\u0435\u0440\u0435\u0441\u0447\u0438\u0442\u0430\u0442\u044C \u043F\u0440\u0438\u0437\u043D\u0430\u043A "\u0431\u0435\u0437\u043D\u0430\u043B\u0438\u0447\u043D\u043E\u0441\u0442\u0438" \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u0430 \u043D\u0430 \u043E\u0431\u0449\u0438\u0445 \u043E\u0441\u043D\u043E\u0432\u0430\u043D\u0438\u044F\u0445, \u0443\u0434\u0430\u043B\u0438\u0442\u0435 \u0435\u0433\u043E \u0438\u0437 \u044D\u0442\u043E\u0433\u043E \u0441\u043F\u0438\u0441\u043A\u0430.',-1),ls={__name:"CashlessPromotional",setup(_){const{getHandbook:d}=g(),n=h("consumption");return Y(n,l=>{localStorage.setItem("tab",JSON.stringify(l))}),Z(async()=>{await d(),n.value=localStorage.getItem("tab")?JSON.parse(localStorage.getItem("tab")):"handbook"}),(l,c)=>(b(),B("div",ye,[e(J,{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=o=>n.value=o),class:"text-black","active-color":"secondary","indicator-color":"secondary",align:"justify","narrow-indicator":""},{default:u(()=>[e(q,{name:"consumption",label:"\u0420\u0430\u0441\u0447\u0435\u0442 \u0440\u0430\u0441\u0445\u043E\u0434\u0430"}),e(q,{name:"handbook",label:"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432"}),e(q,{name:"settings",label:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438"})]),_:1},8,["modelValue"]),e(G,{modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=o=>n.value=o),animated:""},{default:u(()=>[e(D,{class:"panel",name:"consumption"},{default:u(()=>[ke,we,$e,e(fe)]),_:1}),e(D,{class:"panel",name:"handbook"},{default:u(()=>[Ce,Ve,xe,Se,e(pe)]),_:1}),e(D,{class:"panel",name:"settings"},{default:u(()=>[Te,Be,Qe,e(ge)]),_:1})]),_:1},8,["modelValue"])]))}};export{ls as default};
